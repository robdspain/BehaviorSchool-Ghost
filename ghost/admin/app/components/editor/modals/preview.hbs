<div class="gh-post-preview-modal">
    <header class="modal-header gh-post-preview-header" data-test-modal="preview-email">
        <div class="left">
            <h2>Preview</h2>
        </div>
        <div class="gh-post-preview-btn-group">
            <div class="gh-contentfilter gh-btn-group">
                    <button type="button" class="gh-btn gh-post-preview-mode {{if (or (eq this.tab "browser") (eq this.tab "mobile")) "gh-btn-group-selected"}}" {{on "click" (fn this.changeTab "browser")}}><span>Web</span></button>
                {{#if (and (not-eq this.settings.membersSignupAccess "none") (not-eq this.settings.editorDefaultEmailRecipients "disabled"))}}
                    {{#if (and @data.publishOptions.post.isPost (not @data.publishOptions.user.isContributor))}}
                        <button type="button" class="gh-btn {{if (eq this.tab "email") "gh-btn-group-selected"}} gh-post-preview-mode" {{on "click" (fn this.changeTab "email")}} data-test-button="email-preview"><span>Email</span></button>
                    {{/if}}
                {{/if}}
            </div>
            <div class="gh-contentfilter-divider"></div>
            <div class="gh-contentfilter gh-btn-group">
                <button type="button" class="gh-btn {{if (or (eq this.tab "browser") (eq this.tab "email")) "gh-btn-group-selected"}} gh-post-preview-mode" {{on "click" (fn this.changeTab "browser")}}><span>{{svg-jar "laptop"}}</span></button>
                <button type="button" class="gh-btn {{if (eq this.tab "mobile") "gh-btn-group-selected"}} gh-post-preview-mode" {{on "click" (fn this.changeTab "mobile")}}><span>{{svg-jar "mobile-phone"}}</span></button>
            </div>
            <div class="gh-contentfilter-divider"></div>
            <span class="gh-select gh-web-preview-segment">
                <PowerSelect
                    @selected={{hash value="free" label="Free member"}}
                    @options={{if (eq this.tab "email")
                        (array
                            (hash value="free" label="Free member")
                            (hash value="paid" label="Paid member")
                        )
                        (array
                            (hash value="anonymous" label="Anonymous")
                            (hash value="free" label="Free member")
                            (hash value="paid" label="Paid member")
                        )
                    }}
                    @onChange={{this.noop}}
                    @triggerComponent={{component "gh-power-select/trigger"}}
                    @triggerClass="gh-preview-segment-trigger"
                    @dropdownClass="gh-preview-segment-dropdown"
                    as |option|
                >
                    {{option.label}}
                </PowerSelect>
            </span>
        </div>
        <div class="right">
            {{#if (eq this.tab "email")}}
                <div class="gh-post-test-email-group">
                    <GhDropdownButton
                        @dropdownName="post-preview-test-email"
                        @classNames="gh-btn gh-btn-icon gh-post-preview-email-trigger"
                        data-test-button="post-preview-test-email"
                    >
                        <span>{{svg-jar "send-email"}}Test</span>
                    </GhDropdownButton>
                    <GhDropdown
                        @name="post-preview-test-email"
                        @classNames="dropdown-menu gh-post-preview-email-test-dropdown"
                        @onOpen={{this.focusInput}}
                    >
                        <div class="gh-post-preview-email-test">
                            <form class="form-group">
                                <label for="post-preview-email-input">Send test email</label>
                                <Input
                                    @value={{this.previewEmailAddress}}
                                    class="gh-input gh-input-x gh-post-preview-email-input"
                                    placeholder="you@yoursite.com"
                                    aria-label="Email address to receive preview"
                                    aria-invalid={{if this.sendPreviewEmailError "true"}}
                                    aria-describedby={{if this.sendPreviewEmailError "sendError"}}
                                    data-post-preview-email-input
                                    autofocus="true"
                                    {{on-key "Enter" (perform this.sendPreviewEmailTask)}}
                                />
                                <p class="description">You'll receive this as a free member.</p>
                                <GhTaskButton
                                    @task={{this.sendPreviewEmailTask}}
                                    @buttonText="Send"
                                    @successText="Sent"
                                    @runningText="Sending..."
                                    @class="gh-btn gh-btn-icon gh-btn-primary"
                                    data-test-button="send-test-email"
                                />
                            </form>
                        </div>

                        {{#if this.sendPreviewEmailError}}
                            <div class="gh-post-preview-email-error">
                                <span class="response" id="sendError">{{this.sendPreviewEmailError}}</span>
                            </div>
                        {{/if}}
                    </GhDropdown>
                </div>
            {{else}}
                <button type="button" {{on "click" (perform this.copyPreviewUrl)}} class="gh-btn gh-post-preview-url gh-tooltip-trigger tooltip-bottom no-shortcut">
                    <span>
                        {{#if this.copyPreviewUrl.isRunning}}
                            {{svg-jar "check-circle" class="check v-mid mr1 ml2"}} Copied
                        {{else}}
                            {{svg-jar "link"}}
                        {{/if}}
                    </span>
                    <GhTooltip @text="Copy preview link" />
                </button>
                <a href={{@post.previewUrl}} target="_blank" rel="noopener noreferrer" class="gh-btn gh-publish-preview-newtab gh-tooltip-trigger tooltip-bottom no-shortcut">
                    <span>{{svg-jar "external"}}</span>
                    <GhTooltip @text="Open in new tab" />
                </a>
            {{/if}}
            <div class="gh-contentfilter-divider"></div>
            <button
                type="button"
                class="gh-btn gh-btn-editor gh-editor-preview-trigger active"
                {{on "click" @close}}
            >
                <span>Close</span>
            </button>

            {{#if @data.publishOptions.user.isContributor}}
                <GhTaskButton
                    @buttonText="Save"
                    @task={{@data.saveTask}}
                    @runningText="Saving"
                    @class="gh-btn gh-btn-icon gh-btn-editor gh-editor-save-trigger contributor-save-button"
                    data-test-preview-contributor-save />
            {{else}}
                <button
                    type="button"
                    class="gh-btn gh-btn-primary"
                    {{on "click" @data.togglePreviewPublish}}
                >
                    <span>Publish</span>
                </button>
            {{/if}}
        </div>
    </header>

    {{#if this.saveFirstTask.isRunning}}
        <GhLoadingSpinner />
    {{else}}
        {{#if (eq this.tab "browser")}}
            <Editor::Modals::Preview::Browser
                @post={{@data.publishOptions.post}}
                @skipAnimation={{this.skipAnimation}}
            />
        {{/if}}

        {{#if (and (eq this.tab "mobile"))}}
            <Editor::Modals::Preview::Mobile
                @post={{@data.publishOptions.post}}
                @skipAnimation={{this.skipAnimation}}
            />
        {{/if}}

        {{#unless @data.publishOptions.user.isContributor}}
            {{#if (and (eq this.tab "email") @data.publishOptions.post.isPost)}}
                <Editor::Modals::Preview::Email
                    @post={{@data.publishOptions.post}}
                    @newsletter={{@data.publishOptions.newsletter}}
                    @skipAnimation={{this.skipAnimation}}
                    @savePostTask={{@data.savePostTask}}
                />
            {{/if}}
        {{/unless}}
    {{/if}}
</div>